



<section class="main-content columns is-fullheight custom-background-color top-margin-offset-sm">
  
  <aside class="column is-2 is-narrow-mobile is-fullheight section">
    <h2 class="title is-2">Buddies Attending: <%= image_tag 'css/bubbles_edit.png', :class => "attending-bubbles" %></h2>
      <% @meetup.users.each do |user| %>

        <div class="card attending-resize card-bottom-margin">
          <div class="card-image">
            <figure class="image is-4by3">
              <%= image_tag user.image_url %>
            </figure>
          </div>
          <div class="card-content">
            <div class="media">
              <div class="media-content">
                <p class="title is-4"><%= user.first_name %> <%= user.last_name%> </p>
                <p class="subtitle is-6"><%= user.email %></p>
              </div>
            </div>

          </div>
        </div>

      <% end  %>
  </aside>

  <div class="container column is-10">

    <h1 class="show-meetup-heading">Meetup:</h1>


<div class="show-meetup-content-wrapper">


<h2 class="show-meetup-name"><%= @meetup.name %></h2>


<p>
  <strong>Description:</strong>
  <%= @meetup.description %>
</p>

<p>
  <strong>Is commercial trip:</strong>
  <%= @meetup.is_commercial_trip %>
</p>

<p>
  <strong>Street address:</strong>
  <%= @meetup.street_address.titleize %>
</p>

<p>
  <strong>City:</strong>
  <%= @meetup.city.titleize %>
</p>

<p>
  <strong>State:</strong>
  <%= @meetup.state.upcase %>
</p>

<p>
  <strong>Country:</strong>
  <%= @meetup.country.titleize %>
</p>

<% if !((@meetup.street_address == "") && (@meetup.city == "") && (@meetup.state == "") && (@meetup.country == "")) %>
<div style='width: 800px;'>
  <div id="map" style='width: 800px; height: 400px;'></div>
</div>
<% end %>


<p>
  <strong>Is boat required:</strong>
  <%= @meetup.is_boat_required %>
</p>

<p>
  <strong>Price:</strong>
  <%= @meetup.price %>
</p>

<p>
  <strong>Member limit:</strong>
  <%= @meetup.member_limit %>
</p>

<p>
  <strong>Date:</strong>
  <%= @meetup.date %>
</p>

<% if user_signed_in? %>
<% is_joined = false%>
<% @meetup.meetupmembers.each do |member| %>
  <% if current_user.id == member.user_id %>
    <% is_joined = true %>
    <% if member.can_edit == true %>
      <td><%= link_to 'Edit', edit_meetup_path(@meetup), :class => "button is-warning" %></td>
    <td><%= link_to 'Destroy', @meetup, method: :delete, data: { confirm: 'Are you sure you want to delete this meetup?' }, :class => "button is-danger" %></td>
    <% end %>
  <% end  %>
<% end %>


<% if !(is_joined) %>
  
  <% if @meetup.meetup_type == "diver" %>
    <% if !is_registered_as_diver_or_instructor? %>
      <p><%= link_to 'Please register as a diver', divers_reg_path %> and/or <%= link_to 'please register as an instructor', instructors_reg_path %> to join this meetup! </p>
    <% else %>
      <%= link_to 'Join This Meetup :)', join_meetup_path(@meetup.id), method: :post, :class => "button is-primary" %>
    <% end %>
  <% else %>
    <% if !is_registered_as_diver_or_instructor? %>
      <p><%= link_to 'Please register as a diver', divers_reg_path %> and/or <%= link_to 'please register as an instructor', instructors_reg_path %> to join this meetup! </p>
    <% else %>
      <%= form_tag charges_with_meetup_id_path(@meetup.id) do |f| %>
      <article>
        <% if flash[:error].present? %>
          <div id="error_explanation">
            <p><%= flash[:error] %></p>
          </div>
        <% end %>
      </article>

      <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
              data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
              data-description="Join this meetup"
              data-email="<%= current_user.email %>"
              data-label="Pay and Join This Meetup"
              data-amount="<%= @meetup.convert_price_to_cents(@meetup.price) %>"
              data-locale="auto"></script>
      <% end %>
    <% end %>
  <% end %>


<% end %>
<% end %>

<h2>Comments:</h2>
<% @meetup.comments.each do |comment| %>
  <div>
    <h3><%= comment.user.first_name %> <%= comment.user.last_name %></h3>
    <p><%=comment.created_at %></p>
    <p><%= comment.content %></p>
  </div>
<% end %>

<% if is_joined == true %>
  <%= form_for @comment, url: add_comment_path(@meetup.id), :method => :post do |f| %>
    <div class="field">
      <%= f.label :content %>
      <%= f.text_field :content, id: :content %>
    </div>
    <%= f.submit "Add Comment" %>
  <% end %>
<% end %>


<%= link_to 'Back', meetups_path %>

<script type="text/javascript">
handler = Gmaps.build('Google');
handler.buildMap({
   provider: {

   }, 
   internal: {
     id: 'map'
    }
  },
  function(){
  markers = handler.addMarkers([
    {
      "lat": <%= @meetup.latitude %>,
      "lng": <%= @meetup.longitude %>,
      "picture": {
        "url": "http://res.cloudinary.com/chullman/image/upload/v1525666850/map_marker.png",
        "width":  32,
        "height": 32
      },
      "infowindow": "You're meetup location @ <%=@meetup.full_street_address%>"
    }
  ]);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
});
</script>

</div>
    

  </div>
  
</section>




